<!-- Polymer reddit element using its JSONP api -->

<link rel="import" href="../bower_components/polymer/polymer.html">

<!-- Core elements -->
<link rel="import" href="../bower_components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/core-scroll-header-panel/core-scroll-header-panel.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/core-menu/core-menu.html">
<link rel="import" href="../bower_components/core-icon-button/core-icon-button.html">

<!-- Paper elements -->
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-dropdown/paper-dropdown.html">

<!-- subreddit-list -->
<polymer-element name="subreddit-list" attributes="list currentSubreddit">
  <template>
    <style>
     paper-dropdown {
       color: #1D1D1D;
     }
     paper-item.core-selected {
       background-color: #8755EB;
     }
    </style>

    <paper-menu-button>
      <paper-icon-button icon="menu" noink></paper-icon-button>
      <paper-dropdown class="dropdown">
        <core-toolbar style="background-color: #878BEB; color: white;">
          Subreddits
        </core-toolbar>
        <core-menu>
          <paper-item>Frontpage</paper-item>
          <template repeat="{{item in list}}">
            <paper-item on-click="{{onClick}}">{{item.display_name}}</paper-item>
          </template>
        </core-menu>
      </paper-dropdown>
    </paper-menu-button>
  </template>
  <script>
   Polymer({
     created: function() {
       this.subreddits = [];
     },
     onClick: function(event, detail, sender) {
       this.fire('subreddit-selected',
                 {subreddit: event.target.templateInstance.model.item});
     }
   });
  </script>
</polymer-element>

<!-- post-list -->

<!-- polymer-reddit -->
<polymer-element name="polymer-reddit">
  <template>
    <style>
     :host {
       display: block;
       font-family: Lato;
       color: white;
     }
     :host(.core-selected) {
       background-color: #8755EB;
     }
     core-drawer-panel, core-scroll-header-panel {
       background-color: #1D1D1D;
     }
    </style>

    <core-drawer-panel responsiveWidth="900px" selected="main">
      <core-header-panel drawer>
        <core-toolbar style="background-color: #878BEB">
          Subreddits
        </core-toolbar>
        <subreddit-list list="{{subreddits}}"
                        on-subreddit-selected="{{subredditSelected}}">
        </subreddit-list>
      </core-header-panel>
      <core-scroll-header-panel main condenses keepCondensedHeader >
        <core-toolbar class="small" style="background-color: #878BEB">
          <core-icon-button icon="menu" id="drawer_toggle"></core-icon-button>
          <h1>Polymer Reddit</h1>
        </core-toolbar>
        <div>TEST</div>
        <div>TEST1</div>
        <x-foo>test4</x-foo>
      </core-scroll-header-panel>
    </core-drawer-panel>
  </template>
  <script>
   Polymer({
     created: function() {
       this.listing = [];
       this.subreddits = [];
       this.currentSubreddit = ""
     },
     /* Reddit Api
        ==========
        subreddits : res['data']['children'][n]['data'] (Map of an actual subreddit)
        /r/sub.json : res['data']['children'][n]['data'] (Map of an actual post)
      */
     ready: function() {
       // Wraps cross-domain requests for Frontpage and subreddit list in script tags
       var redditElement = this;
       var subCallback = "subredditcb";
       var subReq = document.createElement('script');
       subReq.src = "http://reddit.com/subreddits.json?jsonp=" + subCallback;
       var frontCallback = "frontpagecb";
       var frontReq = document.createElement('script');
       frontReq.src = "http://reddit.com/.json?jsonp=" + frontCallback;

       // JSONP callbacks
       window[subCallback] = function(res) {
         redditElement.subreddits = res.data.children
                                       .map(function(n) { return n.data });
         console.log(res);
         delete window[subCallback];
       };
       window[frontCallback] = function(res) {
         redditElement.listing = res.data.children
                                    .map(function(n) { return n.data });
         console.log(res);
         delete window[frontCallback];
       }

       // Loads the scripts
       document.head.appendChild(subReq);
       document.head.appendChild(frontReq);
     },
     subredditSelected: function(event, detail) {
       console.log('test');
     }
   });
  </script>
</polymer-element>
